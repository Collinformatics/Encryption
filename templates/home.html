<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
        <script src="AES.js"></script>

        <title>Application</title>
    </head>
    <body>
        <h1>AES Encryption</h1>
        <div class="container">
            <form action="/run" method="POST" enctype="multipart/form-data" class="input-form">
                <div class="div-header">Key:</div>
                <div class="form-group">
                    <input type="text" id="key" name="key" required value="">
                </div>
                <div class="form-group">
                    <div class="div-header">Message:</div>
                    <textarea id="message" name="message" required class="containerTextbox" value=""></textarea>
                </div>
                <button type="button" onclick="encryptMessage(event)">Encrypt</button>
            </form>
        </div>
        <script>
            function encryptMessage(event) {
                event.preventDefault(); // Prevent any default form action

                // Handle the inputs
                let message = document.getElementById('message').value;
                let key = document.getElementById('key').value;
                console.log(message + '\n' + key + '\n');

                // Inspect input field
                if (!message || !key) {
                    alert("Please fill out all required fields.");
                    return;
                }

                // Make a form for the inputs
                const formData = new FormData();
                formData.append('message', message); // Add input to the form

                // Pass the form to the backend script
                fetch('/run', {
                    method: 'POST',
                    body: formData
                })

                // Inspect run
                .then(response => {
                    if (!response.ok) throw new Error("Encryption failed (A), please try again.");
                    return response.json();
                })
                .then(data => {
                    const newDiv = document.createElement('div');
                    newDiv.className = 'container';
                    Object.assign(newDiv.style, {
                        backgroundColor: "{{ colorBG }}",
                        color: "{{ white }}",
                        fontSize: "20px",
                        textAlign: "center",
                        borderRadius: "{{ borderRad }}px",
                        display: "flex",
                        flexDirection: "column",
                        alignItems: "center",
                        padding: "{{ padTB }}px {{ padSide }}px {{ padTB }}px {{ padSide }}px",
                        margin: "{{ spacer }}px auto",
                        marginBottom: "{{ marginB }}px"
                    });

                // Pass data into the HTML script
                newDiv.innerHTML = `
                    <div class="div-header">Results:</div>
                    <div class="container-text">
                        <p>Received Message: ${data.message}</p>
                    </div>
                `;

                document.body.appendChild(newDiv);
                })
                .catch(error => {
                    console.error('Error:', error);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'container';
                    errorDiv.innerHTML = `<p style="color: red;">
                        Encryption failed (B), please try again.</p>`;
                    document.body.appendChild(errorDiv);
                });
            }
        </script>
    </body>
</html>